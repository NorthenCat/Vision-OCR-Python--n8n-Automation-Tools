<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONL Formatter - OCR Vision App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                200: '#bae6fd',
                300: '#7dd3fc',
                400: '#38bdf8',
                500: '#0ea5e9',
                600: '#0284c7',
                700: '#0369a1',
                800: '#075985',
                900: '#0c4a6e',
              },
            },
            fontFamily: {
              sans: ['Inter', 'system-ui', 'sans-serif'],
            },
          },
        },
      }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet">
  </head>
  <body class="bg-gray-50 text-gray-900 font-sans flex flex-col min-h-screen">
    <div id="loadingOverlay"
      class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center">
      <div
        class="text-center bg-white p-6 rounded-lg shadow-xl max-w-md mx-auto">
        <div
          class="inline-block animate-spin rounded-full h-12 w-12 border-t-4 border-primary-500 border-opacity-50 border-r-4 border-primary-500"></div>
        <p class="text-gray-800 mt-4 text-lg font-semibold">Generating
          JSONL...</p>
        <p class="text-gray-500 text-sm mt-2">Processing Excel data for
          fine-tuning</p>
      </div>
    </div>

    <nav class="bg-white shadow-sm">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <svg class="h-8 w-8 text-primary-500" viewBox="0 0 24 24"
              fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M7 3C4.79086 3 3 4.79086 3 7V17C3 19.2091 4.79086 21 7 21H17C19.2091 21 21 19.2091 21 17V7C21 4.79086 19.2091 3 17 3H7Z"
                stroke="currentColor" stroke-width="2" />
              <path d="M9 9H15" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" />
              <path d="M9 13H15" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" />
              <path d="M9 17H13" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" />
            </svg>
            <h1 class="ml-2 text-xl font-semibold text-gray-800">JSONL
              Formatter</h1>
          </div>
          <div class="flex items-center space-x-3">
            <a href="/ocr-test"
              class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-purple-600 hover:text-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
              OCR Test
            </a>
            <a href="/excel-manager"
              class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-green-600 hover:text-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Excel Manager
            </a>
            <a href="/"
              class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-primary-600 hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
              </svg>
              Back to Main
            </a>
          </div>
        </div>
      </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-2">JSONL Formatter for
          Fine-tuning</h2>
        <p class="text-gray-600">Generate JSONL training data from Excel files
          for fine-tuning language models.</p>
        <div class="mt-3 bg-amber-50 border border-amber-200 rounded-md p-3">
          <p class="text-sm text-amber-800">
            <strong>Note:</strong> Upload an Excel file below that contains
            processed OCR data.
            The raw OCR text from column BY will automatically be used as user
            prompts for fine-tuning.
          </p>
        </div>
      </div>

      <!-- Excel Upload Section -->
      <div
        class="mb-6 bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Excel File Upload
        </h3>

        <div id="excelUploadArea"
          class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary-400 transition-colors cursor-pointer">
          <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor"
            fill="none" viewBox="0 0 48 48">
            <path
              d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <div class="mt-4">
            <label for="excelFile" class="cursor-pointer">
              <span class="mt-2 block text-sm font-medium text-gray-900">Click
                to upload Excel file</span>
              <span class="block text-xs text-gray-500 mt-1">XLSX or XLS files
                only</span>
            </label>
            <input id="excelFile" name="excel_file" type="file"
              accept=".xlsx,.xls" class="sr-only" />
          </div>
        </div>

        <div id="excelUploadStatus" class="mt-4 hidden">
          <div class="bg-green-50 border border-green-200 rounded-md p-3">
            <div class="flex">
              <svg class="h-5 w-5 text-green-400" fill="currentColor"
                viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  clip-rule="evenodd"></path>
              </svg>
              <div class="ml-3">
                <p class="text-sm font-medium text-green-800"
                  id="excelUploadMessage">Excel file uploaded successfully!</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Left Panel - Prompt Configuration -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <h3
            class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2 text-indigo-500" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round"
                stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Prompt Configuration
          </h3>

          <form id="jsonlForm" class="space-y-6">
            <div>
              <label for="systemPrompt"
                class="block text-sm font-medium text-gray-700 mb-2">System
                Prompt</label>
              <textarea id="systemPrompt" name="system_prompt" rows="4"
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                placeholder="Enter the system prompt that defines the AI's role and behavior...">You are an expert OCR data processor specialized in extracting and structuring Indonesian family card (Kartu Keluarga) information. Convert raw OCR text into structured JSON format following the exact schema provided.</textarea>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
              <h4 class="text-sm font-medium text-blue-900 mb-2">User Prompt
                (Auto-Generated):</h4>
              <p class="text-sm text-blue-800 mb-2">The user prompts will
                automatically use the raw OCR text from column BY in your Excel
                file.</p>
              <div class="bg-white rounded border p-2">
                <p class="text-xs text-gray-600 font-mono">Each row's RAW DATA
                  (column BY) will be used as the user prompt containing the
                  actual OCR text to be processed.</p>
              </div>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
              <h4 class="text-sm font-medium text-blue-900 mb-2">Output Format
                Preview:</h4>
              <pre class="text-xs text-blue-800 whitespace-pre-wrap">{
  "isKK": true,
  "AnggotaKeluarga": [
    {
      "img_name": "filename.jpg",
      "NamaKepalaKeluarga": "...",
      "Alamat": "...",
      "RT": "003",
      "RW": "02",
      "NIK": "16-digit number",
      "NamaLengkap": "...",
      // ... other fields
    }
  ]
}</pre>
            </div>

            <button type="submit" id="generateBtn"
              class="w-full flex justify-center items-center px-4 py-3 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Generate JSONL for Fine-tuning
            </button>
          </form>

          <div class="mt-6">
            <h4 class="text-md font-medium text-gray-700 mb-3">Column
              Mapping:</h4>
            <div
              class="bg-gray-50 border border-gray-200 rounded-md p-3 max-h-40 overflow-y-auto">
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div><strong>Excel → JSON</strong></div>
                <div></div>
                <div>Filename → img_name</div>
                <div>NIK → NIK</div>
                <div>NomorKK → NoKK</div>
                <div>NamaLengkap → NamaLengkap</div>
                <div>JenisKelamin → JenisKelamin</div>
                <div>TempatLahir → TempatLahir</div>
                <div>TanggalLahir → TanggalLahir</div>
                <div>Alamat → Alamat</div>
                <div>JenisPekerjaan → JenisPekerjaan</div>
                <div>Agama → Agama</div>
                <div>RT → RT (3 digits)</div>
                <div>RW → RW (2 digits)</div>
                <div>Desa/Kelurahan → DesaKelurahan</div>
                <div>Kecamatan → Kecamatan</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Panel - Results -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
          <h3
            class="text-lg font-semibold mb-4 text-gray-800 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 mr-2 text-green-500" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Generation Results
          </h3>

          <div id="resultsContainer">
            <div id="noResults"
              class="bg-gray-50 border border-gray-200 rounded-md p-8 text-center">
              <svg xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 mx-auto text-gray-400" fill="none"
                viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <p class="text-gray-500 mt-4">No JSONL generated yet.</p>
              <p class="text-gray-400 text-sm mt-2">Configure prompts and
                generate to see results here</p>
            </div>

            <div id="successResults" class="hidden">
              <div
                class="bg-green-50 border border-green-200 rounded-md p-4 mb-4">
                <div class="flex">
                  <svg class="h-5 w-5 text-green-400" fill="currentColor"
                    viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                      clip-rule="evenodd"></path>
                  </svg>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-green-800"
                      id="successMessage">JSONL generated successfully!</p>
                  </div>
                </div>
              </div>

              <div class="space-y-4">
                <div>
                  <div class="flex justify-between items-center mb-2">
                    <label
                      class="block text-sm font-medium text-gray-700">Generated
                      JSONL Preview:</label>
                    <a id="downloadLink" href="#"
                      class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                      <svg xmlns="http://www.w3.org/2000/svg"
                        class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                      </svg>
                      Download JSONL
                    </a>
                  </div>
                  <div
                    class="bg-gray-900 border border-gray-700 rounded-md p-4 max-h-96 overflow-y-auto">
                    <pre id="jsonlPreview"
                      class="text-xs text-green-400 font-mono whitespace-pre-wrap"></pre>
                  </div>
                </div>
              </div>
            </div>

            <div id="errorResults" class="hidden">
              <div class="bg-red-50 border border-red-200 rounded-md p-4">
                <div class="flex">
                  <svg class="h-5 w-5 text-red-400" fill="currentColor"
                    viewBox="0 0 20 20">
                    <path fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                      clip-rule="evenodd"></path>
                  </svg>
                  <div class="ml-3">
                    <p class="text-sm font-medium text-red-800">Error occurred
                      during JSONL generation</p>
                    <div class="mt-2">
                      <pre id="errorMessage"
                        class="text-sm text-red-700 whitespace-pre-wrap"></pre>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-white border-t border-gray-200 mt-auto">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <p class="text-gray-500 text-sm text-center">JSONL Formatter - OCR
          Vision App © 2025</p>
      </div>
    </footer>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const jsonlForm = document.getElementById('jsonlForm');
        const generateBtn = document.getElementById('generateBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        
        // Excel upload elements
        const excelUploadArea = document.getElementById('excelUploadArea');
        const excelFileInput = document.getElementById('excelFile');
        const excelUploadStatus = document.getElementById('excelUploadStatus');
        const excelUploadMessage = document.getElementById('excelUploadMessage');
        
        // Result elements
        const noResults = document.getElementById('noResults');
        const successResults = document.getElementById('successResults');
        const errorResults = document.getElementById('errorResults');
        const successMessage = document.getElementById('successMessage');
        const jsonlPreview = document.getElementById('jsonlPreview');
        const downloadLink = document.getElementById('downloadLink');
        const errorMessage = document.getElementById('errorMessage');

        // Excel upload functionality
        excelUploadArea.addEventListener('click', (e) => {
          // Use event delegation to handle dynamically created input
          const input = document.getElementById('excelFile');
          if (input) {
            input.click();
          }
        });

        // Use event delegation for file input change
        document.addEventListener('change', (e) => {
          if (e.target.id === 'excelFile') {
            const file = e.target.files[0];
            if (file) {
              uploadExcelFile(file);
            }
          }
        });

        function uploadExcelFile(file) {
          const formData = new FormData();
          formData.append('excel_file', file);

          // Show uploading status
          excelUploadStatus.classList.add('hidden');
          excelUploadArea.innerHTML = `
            <div class="flex items-center justify-center">
              <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-primary-500"></div>
              <span class="ml-3 text-gray-600">Uploading...</span>
            </div>
          `;

          fetch('/upload-excel', {
            method: 'POST',
            body: formData
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              excelUploadMessage.textContent = data.success;
              excelUploadStatus.classList.remove('hidden');
              
              // Reset upload area
              excelUploadArea.innerHTML = `
                <svg class="mx-auto h-12 w-12 text-green-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                  <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <div class="mt-4">
                  <label for="excelFile" class="cursor-pointer">
                    <span class="mt-2 block text-sm font-medium text-green-600">✓ Excel file uploaded successfully</span>
                    <span class="block text-xs text-gray-500 mt-1">Click to upload a different file</span>
                  </label>
                  <input id="excelFile" name="excel_file" type="file" accept=".xlsx,.xls" class="sr-only" />
                </div>
              `;
            } else {
              showError(data.error || 'Failed to upload Excel file');
              resetUploadArea();
            }
          })
          .catch(error => {
            console.error('Error:', error);
            showError('Network error during file upload');
            resetUploadArea();
          });
        }

        function resetUploadArea() {
          excelUploadArea.innerHTML = `
            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div class="mt-4">
              <label for="excelFile" class="cursor-pointer">
                <span class="mt-2 block text-sm font-medium text-gray-900">Click to upload Excel file</span>
                <span class="block text-xs text-gray-500 mt-1">XLSX or XLS files only</span>
              </label>
              <input id="excelFile" name="excel_file" type="file" accept=".xlsx,.xls" class="sr-only" />
            </div>
          `;
        }

        // Form submission
        jsonlForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          const systemPrompt = document.getElementById('systemPrompt').value.trim();
          
          if (!systemPrompt) {
            alert('Please fill in the system prompt');
            return;
          }

          generateBtn.disabled = true;
          loadingOverlay.classList.remove('hidden');

          fetch('/generate-jsonl', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              system_prompt: systemPrompt
            })
          })
          .then(response => response.json())
          .then(data => {
            loadingOverlay.classList.add('hidden');
            generateBtn.disabled = false;
            
            if (data.success) {
              showSuccess(data);
            } else {
              showError(data.error || 'Unknown error occurred');
            }
          })
          .catch(error => {
            loadingOverlay.classList.add('hidden');
            generateBtn.disabled = false;
            console.error('Error:', error);
            showError(`Network error: ${error.message}`);
          });
        });

        function showNoResults() {
          noResults.classList.remove('hidden');
          successResults.classList.add('hidden');
          errorResults.classList.add('hidden');
        }

        function showSuccess(data) {
          noResults.classList.add('hidden');
          successResults.classList.remove('hidden');
          errorResults.classList.add('hidden');

          successMessage.textContent = data.success;
          downloadLink.href = data.download_path;
          
          if (data.preview) {
            jsonlPreview.textContent = JSON.stringify(JSON.parse(data.preview), null, 2);
          }
        }

        function showError(error) {
          noResults.classList.add('hidden');
          successResults.classList.add('hidden');
          errorResults.classList.remove('hidden');

          errorMessage.textContent = error;
        }

        // Initialize
        showNoResults();
      });
    </script>
  </body>
</html>